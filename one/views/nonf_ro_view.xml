<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        <record id="view_nonf_ro_form" model="ir.ui.view">
            <field name="name">nonf.ro.form</field>
            <field name="model">nonf.ro</field>
            <field name="priority" eval="20"/>
            <field name="arch" type="xml">
                <form string="Repair Order" class="o_sale_order">
                    <header>
                        <button name="action_confirm"
                            confirm="Click Ok button to confirm your action."
                            string="Confirm R.O." type="object"
                            attrs="{'invisible': [('state', 'not in', ['draft'])]}"/>                        
                        <!--
                        <button name="action_cancel"
                            confirm="Click Ok button to confirm your action."
                            string="Cancel R.O." type="object"
                            attrs="{'invisible': [('state', 'not in', ['draft'])]}"/>
                        -->  
                        <button name="%(action_nonf_ro_cancel)d" string="Cancel" type="action" 
                            state="draft" class="oe_highlight" groups="one.msd_administrators,one.group_service_advisors"
                            attrs="{'invisible': [('state', '!=', 'draft')]}" />                        
                        
                        <field name="state" widget="statusbar"/>
                    </header>
                    <sheet>
                        <div class="oe_title">
                            <h1><field name="name" readonly="1" help="Auto-generated field"/></h1>
                            <h3><field name="estimate_id" attrs="{'visible': [('state','=','confirm')]}" readonly="1"/></h3>
                        </div>
                        <group>
                            <group>
                                <field name="customer_id" attrs="{'readonly': [('state','!=','draft')]}"
                                    options="{'no_create': True, 'no_quick_create': True, 'no_create_edit': True, 'no_open': True, 'always_reload': True}"
                                    domain="['|',('customer','=',True),('customer_type_parts_and_service','=',True)]"/>
                                <field name="nonf_unit_id" required="1" attrs="{'readonly': [('state','!=','draft')]}"
                                    options="{'no_create': True, 'no_quick_create': True, 'no_create_edit': True, 'no_open': True}"/>
                                <field name="maker_id"
                                    options="{'no_create': True, 'no_quick_create': True, 'no_create_edit': True, 'no_open': True, 'always_reload': True}"/>
                                <field name="model_id"
                                    options="{'no_create': True, 'no_quick_create': True, 'no_create_edit': True, 'no_open': True, 'always_reload': True}"/>
                                <field name="chassis_number"/>
                                <field name="engine_number"/>
                                <field name="conduction_sticker"/>
                                <field name="plate_number"/>
                            </group>
                            <group>
                                <field name="date" attrs="{'readonly': [('state','!=','draft')]}"/>
                                <field name="service_advisor_id" attrs="{'readonly': [('state','!=','draft')]}"
                                    options="{'no_create': True, 'no_quick_create': True, 'no_create_edit': True, 'no_open': True}"/>                            
                                <field name="run_km" attrs="{'readonly': [('state','!=','draft')]}"/>
                            </group>
                        </group>
                        <notebook>
                            <page string="Repair Order Details">
                                <field name="ro_lines" attrs="{'readonly': [('state','!=','draft')]}">
                                    <tree>
                                        <field name="name"/>
                                    </tree>
                                    <form>
                                        <field name="name"/>
                                    </form>
                                </field>
                            </page>
                        </notebook>
                        
                        <div>
                            <field name="cancel_reason" attrs="{'inivisible': [('state','!=','cancel')]}"/>
                        </div>                    
                    </sheet>
                </form>
            </field>
        </record>

        <record id="view_nonf_ro_tree" model="ir.ui.view">
            <field name="name">nonf.ro.tree</field>
            <field name="model">nonf.ro</field>
            <field name="priority" eval="20"/>
            <field name="arch" type="xml">
                <tree string="Repair Orders" class="o_sale_order" default_order="name desc" 
                    decoration-muted="state=='cancel'">
                    <field name="name"/>
                    <field name="date"/>
                    <field name="customer_id"/>
                    <field name="service_advisor_id"/>
                    <field name="maker_id"/>
                    <field name="model_id"/>
                    <field name="nonf_unit_id"/>
                    <field name="chassis_number"/>
                    <field name="engine_number"/>
                    <field name="conduction_sticker"/>
                    <field name="plate_number"/>
                    <field name="state"/>
                    <field name="estimate_id"/>
                </tree>
            </field>
        </record>

        <record model="ir.ui.view" id="nonf_ro_search">
            <field name="name">Search Repair Orders</field>
            <field name="model">nonf.ro</field>
            <field name="arch" type="xml">
                <search string="Repair Order">
                    <field name="name"/>
                    <field name="customer_id"/>
                    <field name="nonf_unit_id"/>
                    <field name="maker_id"/>
                    <field name="model_id"/>
                    <field name="chassis_number"/>
                    <field name="engine_number"/>
                    <field name="conduction_sticker"/>
                    <field name="plate_number"/>
                    <filter string="Draft" name="drafts" domain="[('state','=', 'draft')]"/>
                    <filter name="group_type" string="Customer" icon="terp-partner" context="{'group_by':'customer_id'}"/>                    
                </search>
            </field>
        </record>

        <record model="ir.sequence" id="nonf_ro_seq">
            <field name="name">NF - R.O. Number</field>
            <field name="code">nonf.ro.seq</field>
            <field name="prefix">NF-RO#</field>
            <field name="padding">6</field>
        </record>

        <record id="nonf_ro_act_window" model="ir.actions.act_window">
            <field name="name">NF-Repair Orders</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">nonf.ro</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>   
            <field name="context">{"search_default_drafts":1}</field>                      
        </record>

        <menuitem id="nonf_ro_menu"
            name="Repair Orders"
            action="nonf_ro_act_window"
            parent="fos_service_nonf_tasks_menu"
            sequence="1"/>
    </data>
</odoo>