<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        <record model="ir.ui.view" id="fmpi_view_vqir_tree">
            <field name="name">V.Q.I.R. List</field>
            <field name="model">fmpi.vqir</field>
            <field name="arch" type="xml">
                <tree create="false" delete="false" edit="false" default_order="name desc">
                    <field name="name"/>
                    <field name="vqir_type"/>
                    <field name="vqir_date"/>
                    <field name="ss_name"/>
                    <field name="reps_name"/>
                    <field name="fos_fu_id"/>
                    <field name="fu_local_name"/>
                    <field name="fu_chassis_number"/>
                    <field name="submitted_date"/>
                    <field name="pj_job_total"/>
                    <field name="pj_parts_total"/>
                    <field name="pj_total"/>
                    <field name="pj_approved_total"/>   
                    <field name="vqir_state"/>
                </tree>
            </field>
        </record>
    
        <record model="ir.ui.view" id="fmpi_vqir_form">
            <field name="name">V.Q.I.R.</field>
            <field name="model">fmpi.vqir</field>
            <field name="arch" type="xml">
            <form create="false" delete="false">
                <header>
                    <field name="vqir_state" widget="statusbar"/>
                    <button name="%(fmpi_vqir_ack_action)d" string="Acknowledge" 
                        type="action" vqir_state="submit" class="oe_highlight"
                        attrs="{'invisible': [('vqir_state', '!=', 'submit')]}" />   
                    <button name="%(fmpi_vqir_approve_action)d" string="Approve" 
                        type="action" vqir_state="ack" class="oe_highlight"
                        attrs="{'invisible': [('vqir_state', '!=', 'ack')]}"/>   
                    <button name="%(fmpi_vqir_disapprove_action)d" string="Disapprove" 
                        type="action" vqir_state="ack" class="oe_highlight"
                        attrs="{'invisible': [('vqir_state', '!=', 'ack')]}"/>   
                    <button name="%(fmpi_vqir_dec_action)d" string="Return" 
                        type="action" vqir_state="ack" class="oe_highlight"
                        attrs="{'invisible': [('vqir_state', '!=', 'ack')]}"/>   
                    <button name="%(fmpi_vqir_pd_action)d" string="Set as Paid" 
                        type="action" class="oe_highlight"
                        attrs="{'invisible': [('vqir_state', '!=', 'approved')]}"/>    
                </header>
    	        <sheet>                    
                    <h1><field name="name"/></h1>
                    <group>
                        <group>
                            <field name="vqir_type"/>
                        </group>
                        <group>
                            <field name="vqir_date" string="Date"/>
                        </group>
                    </group>

                    <group string="Unit Information">
                        <group>
                            <field name="fos_fu_id"/>
                            <field name="fu_local_name"/>
                            <field name="fu_description"/>
                            <field name="fu_chassis_number"/>
                            <field name="fu_engine_number"/>
                        </group>
                        <group>
                            <field name="fu_body_type"/>
                            <field name="fu_color"/>
                            <field name="fu_conduction_sticker"/>
                            <field name="fu_plate_number"/>
                            <field name="fu_owner_name"/>
                            <field name="fu_owner_address"/>
                        </group>
                    </group>

                    <group string="Service Station">
                        <group>
                            <field name="ss_name"/>
                            <field name="ss_street1"/>
                            <field name="ss_street2"/>
                            <field name="ss_city"/>
                        </group>
                    <group>
                        <field name="ss_phone"/>
                        <field name="ss_mobile"/>
                        <field name="ss_fax"/>
                        <field name="ss_email"/>
                    </group>
                </group>

                <group string="User's Info">
                    <group>
                        <field name="users_name"/>
                        <field name="users_street1"/>
                        <field name="users_street2"/>
                        <field name="users_city"/>
                    </group>
                    <group>
                        <field name="users_phone"/>
                        <field name="users_mobile"/>
                        <field name="users_fax"/>
                        <field name="users_email"/>
                    </group>
                </group>

                <group string="Reporter's Name">
                    <group>
                        <field name="reps_name"/>
                        <field name="reps_street1"/>
                        <field name="reps_street2"/>
                        <field name="reps_city"/>
                    </group>
                    <group>
                        <field name="reps_phone"/>
                        <field name="reps_mobile"/>
                        <field name="reps_fax"/>
                        <field name="reps_email"/>
                    </group>
                </group>

                <group string="Trouble Report">
                    <group>
                        <field name="date_occur"/>
                        <field name="vqir_city"/>                
                        <field name="driver_name"/>                
                    </group>
                    <group>
                        <field name="place_of_incident"/>
                        <field name="km_1st_trouble"/>
                        <field name="run_km"/>
                    </group>
                </group>

           <group string="Parts &amp; Jobs">
              <field name="fmpi_vqir_parts_and_jobs_line" nolabel="1">
                 <tree mode="tree" editable="bottom">
                   <field name="si_number"/>
                   <field name="si_date"/>
                   <field name="part_id"/>
                   <field name="parts_desc"/>
                   <field name="parts_qty"/>
                   <field name="parts_cost"/>
                   <field name="parts_with_fee"/>
                   <field name="approved_amount"/>
                   <field name="parts_total"/>
                   <field name="job_id"/>
                   <field name="job_code_desc"/>
                   <field name="job_qty"/>
                   <field name="job_cost"/>
                   <field name="job_total"/>
                   <field name="job_approved_amount"/>
                   <field name="job_parts_total"/>
                 </tree>
                 <form string="Trouble Parts and Jobs">
                   <sheet>
                     <h3><field name="name"/></h3>
                     <group>
                       <group>
                         <field name="si_number"/>
                         <field name="si_date"/>
                         <field name="part_id"/>
                         <field name="parts_desc"/>
                         <field name="parts_qty"/>
                         <field name="parts_cost"/>
                         <field name="parts_with_fee"/>
                         <field name="approved_amount"/>
                       </group>
                       <group>
                         <field name="parts_total"/>
                         <field name="job_id"/>                         
                         <field name="job_code_desc"/>
                         <field name="job_qty"/>
                         <field name="job_cost"/>
                         <field name="job_total"/>
                         <field name="job_approved_amount"/> 
                         <field name="job_parts_total"/>
                       </group>
                     </group>
                   </sheet>
                 </form>
                </field>
            </group>
            <group class="oe_subtotal_footer oe_right">
               <div class="oe_subtotal_footer_separator oe_inline">
               <label for="pj_total"/>
               </div>
               <field name="pj_total" nolabel="1" class="oe_subtotal_footer_separator" widget="monetary" options="{'currency_field': 'currency_id'}"/>
                 <div class="oe_inline">
                    <label for="pj_approved_total" attrs="{'invisible': [('vqir_state','in', ['draft','cancel'])]}"/>
                 </div>
                    <field name="pj_approved_total" class="oe_subtotal_footer_separator" widget="monetary" nolabel="1" attrs="{'invisible': [('vqir_state','in', ['draft','cancel'])]}"/>
            </group>
            <field name="remarks" class="oe_inline"/>
            <div class="oe_clear"/>         
                <group>
                    <group string="Trouble explanation">
                        <field name="trouble_explanation" nolabel="1"/>
                    </group>
                    <group string="Trouble cause analysis">
                        <field name="trouble_cause_analysis" nolabel="1"/>
                    </group>
                </group>

                <group>
                    <group string="Disposal measures">
                        <field name="disposal_measures" nolabel="1"/>
                    </group>
                    <group string="Proposal/Requirement for improvement">
                        <field name="proposal_for_improvement" nolabel="1"/>
                    </group>
                </group>
                <group string="Images">
                    <field name="fmpi_vqir_images_line" nolabel="1">
                         <field name="image_small"/>
                         <field name="image_remarks"/>
                      <tree mode="kanban,tree">
                         <field name="image_small" widget="image" class="oe_avatar"/>
                         <field name="image_remarks"/>
                      </tree>
                     <form>
                      <sheet>
                        <h1><field name="name"/></h1>
                        <field name="image" widget="image"/>
                        <field name="image_remarks" nolabel="1"/>
                      </sheet>
                     </form>
                    </field>
                </group>
                <group string="Status Logs">
                    <field name="vqir_state_logs" readonly="1" nolabel="1"/>
                </group>      
          </sheet>              
        </form>
      </field>
    </record>

    <record model="ir.ui.view" id="fmpi_vqir_search">
      <field name="name">Search VQIR</field>
      <field name="model">fmpi.vqir</field>
      <field name="arch" type="xml">
        <search string="V.Q.I.R.">
          <field name="dealer_id"/>
          <field name="name"/>
          <field name="fos_fu_id"/>
          <filter string="Submitted" name="submit" domain="[('vqir_state','=', 'submit')]"/>
        </search>
      </field>
    </record>

    <record model="ir.actions.act_window" id="fmpi_vqir_action_window">
      <field name="name">Dealers Submitted V.Q.I.R.</field>
      <field name="res_model">fmpi.vqir</field>
      <field name="view_mode">tree,form</field>
      <field name="view_id" ref="fmpi_view_vqir_tree"/>
      <field name="search_view_id" ref="fmpi_vqir_search"/>
      <field name="context">{"search_default_submit":1}</field>      
    </record>

    <menuitem name="Dealers V.Q.I.R." id="menu_fmpi_vqir" 
        parent="menu_top_service" 
        sequence="2"
        groups="one.msd_administrators"
	    action="fmpi_vqir_action_window"/>
    </data>
</odoo>
