<?xml version="1.0" encoding="UTF-8" ?>
<odoo>
   <record id="view_service_orders_form" model="ir.ui.view">
        <field name="name">view.service.orders.form</field>
        <field name="model">sale.order</field>
        <field name="priority" eval="21"/>
        <field name="inherit_id" ref="sale.view_order_form"/>
        <field name="arch" type="xml">
            <xpath expr="//form/sheet/notebook/page/field[@name='order_line']" position="inside">
                <form>
                    <sheet>
                        <notebook>
			                <page string="Order Line Details">
                                <group>
                                    <group>
                                        <field name="sequence" invisible="1" widget="handle"/>
                                        <field name="product_updatable" invisible="1"/>
                                        <field name="charged_to"/>
                                        <!-- show units column for parts sales -->
                                        <field name="fu_id"
                                            attrs="{'invisible': [('parent.so_type','in',['service','units','service2'])]}"
                                            options="{'no_create': True, 'no_quick_create': True, 'no_create_edit': True, 'no_open': True}"/>

                                        <field name="product_id" invisible="1"
                                            attrs="{'readonly': [('product_updatable', '=', False)]}"
                                            domain="['|',('type','=','service'),('sub_type','=','parts')]"
                                            force_save="1" options="{'no_create': True, 'no_quick_create': True, 'no_create_edit': True, 'no_open': True}"
                                            context="{'partner_id':parent.partner_id, 'quantity':product_uom_qty, 'pricelist':parent.pricelist_id, 'uom':product_uom, 'company_id': parent.company_id}"/>

                                        <!-- product for parts sales -->
                                        <field name="part_number"
                                            attrs="{'invisible': [('parent.so_type','!=','parts')], 'required': [('parent.so_type','=','parts')]}"
                                            domain="[('sub_type','in',('parts','supplies'))]"/>
                                        <!-- product for servicing sales -->
                                        <field name="parts_and_jobs"
                                            attrs="{'invisible': [('parent.so_type','not in',['service','service2'])], 'required': [('parent.so_type','in',['service','service2'])]}"
                                            domain="['|',('type','=','service'),('sub_type','=','parts')]"/>
                                        <!-- product for units sales -->
                                        <field name="units_and_addons"
                                            attrs="{'invisible': [('parent.so_type','!=','units')], 'required': [('parent.so_type','=','units')]}"
                                            domain="[('sub_type','=','units')]"/>
                                        <field name="name"/>
                                    </group>
                                    <group>
                                        <field name="product_uom_qty" string="Ordered Qty"
                                            context="{'partner_id':parent.partner_id, 'quantity':product_uom_qty, 'pricelist':parent.pricelist_id, 'uom':product_uom, 'company_id': parent.company_id}"/>
                                        <field name="qty_delivered" attrs="{'invisible': [('parent.state', 'not in', ['sale', 'done'])], 'readonly': [('qty_delivered_updateable', '=', False)]}"/>
                                        <field name="qty_invoiced" attrs="{'invisible': [('parent.state', 'not in', ['sale', 'done'])]}"/>
                                        <field name="qty_to_invoice" invisible="1"/>
                                        <field name="product_uom" attrs="{'readonly': [('state', 'in', ('sale','done', 'cancel'))]}"
                                            context="{'company_id': parent.company_id}" groups="product.group_uom" options='{"no_open": True}'/>
                                        <field name="analytic_tag_ids" groups="analytic.group_analytic_accounting" widget="many2many_tags" options="{'color_field': 'color'}"/>
                                        <field name="price_unit" attrs="{'readonly': [('qty_invoiced', '&gt;', 0)]}"/>
                                        <field name="tax_id" widget="many2many_tags" options="{'no_create': True}" domain="[('type_tax_use','=','sale'),('company_id','=',parent.company_id)]"
                                            attrs="{'readonly': [('qty_invoiced', '&gt;', 0)]}"/>
                                        <field name="discount" groups="sale.group_discount_per_so_line"/>
                                        <field name="discount_amount" groups="sale.group_discount_per_so_line"/>
                                        <field name="price_subtotal" widget="monetary" groups="sale.group_show_price_subtotal"/>
                                        <field name="price_total" widget="monetary" groups="sale.group_show_price_total"/>
                                        <field name="qty_delivered_updateable" invisible="1"/>
                                        <field name="state" invisible="1"/>
                                        <field name="invoice_status" invisible="1"/>
                                        <field name="customer_lead" invisible="1"/>
                                        <field name="currency_id" invisible="1"/>
                                    </group>
                                </group>
                            </page>
                            <page string="Time Tracking" attrs="{'invisible': ['|','&amp;', ('parent.so_type','not in',['service','service2']), ('parent.state','not in',['sale','done']), ('parts_and_job_sub_type','!=','labor')]}">
                                <sheet>
                                    <header>
                                        <button name="service_start" string="Start Working" type="object" class="btn-success oe_edit_only"
                                            attrs="{'invisible': ['|',('service_status','in',('start','finish','cancel'))]}" force_save="1"/>
                                        <button name="service_finish" string="Done" type="object" class="btn-success oe_edit_only"
                                            attrs="{'invisible': ['|',('service_status','in',('finish','cancel','pause')),('service_status','=',False)]}"/>
                                        <button name="%(service_takttime_pause_action)d" string="Pause" type="action" class="btn-warning oe_edit_only"
                                            attrs="{'invisible': ['|',('service_status','in',('finish','cancel','pause')),('service_status','=',False)]}"/>
                                         <button name="%(service_takttime_cancel_action)d" string="Cancel" type="action" class="btn-danger oe_edit_only"
                                            attrs="{'invisible': ['|', ('service_status','in',('finish','cancel')),('service_status','=',False)]}"/>
                                        <field name="service_status" widget="statusbar"/>
                                    </header>
                                    <group>
                                        <group>
                                            <field name="service_status" invisible="1"/>
                                            <field name="parts_and_job_sub_type" invisible="1"/>
                                            <field name="service_technicians" widget="many2many_tags" 
                                                domain="[('order_line_id','=',False)]"
                                                attrs="{'readonly': [('service_status','in',('start','finish','cancel'))]}"/>
                                            <field name="service_start_date" readonly="1"/>
                                            <field name="service_end_date" readonly="1"/>
                                        </group>
                                        <group>
                                            <field name="service_duration" widget="float_time" help="Time the currently logged user spent on this workorder."/>
                                        </group>
                                    </group>
                                    <group>
                                        <field name="service_time_ids" nolabel="1">
                                            <tree create="false" delete="false">
                                                <field name="date_start"/>
                                                <field name="date_end"/>
                                                <field name="duration" widget="float_time" sum="Total duration"/>
                                                <field name="user_id"/>
                                                <field name="service_status"/>
                                                <field name="assigned_technicians" widget="many2many_tags"/>
                                            </tree>
                                            <form>
                                                <group>
                                                    <group>
                                                        <field name="date_start"/>
                                                        <field name="date_end"/>
                                                        <field name="duration" widget="float_time"/>
                                                    </group>
                                                    <group>
                                                        <field name="user_id"/>
                                                        <field name="loss_id"/>
                                                    </group>
                                                </group>
                                            </form>
                                        </field>
                                    </group>
                                    <group string="Service Status Logs" attrs="{'invisible':[('service_status_logs','=',False)]}">
                                        <field name="service_status_logs" readonly="1" nolabel="1"/>
                                    </group>
                                </sheet>
                            </page>
                        </notebook>
                    </sheet>
                </form>
            </xpath>
        </field>
    </record>
</odoo>
