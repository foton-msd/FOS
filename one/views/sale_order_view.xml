<odoo>
  <data>
    
    <record id="view_sale_quotation_tree" model="ir.ui.view">
      <field name="name">view.sale.quotation.tree</field>
      <field name="model">sale.order</field>
      <field name="priority" eval="20"/>
      <field name="inherit_id" ref="sale.view_order_tree"/>
      <field name="arch" type="xml">
        <xpath expr="//field[@name='confirmation_date']" position="replace">
          <field name="date_order" widget="date"/>
        </xpath>
      </field>
    </record>
    <record id="view_sale_quotation_form" model="ir.ui.view">
      <field name="name">view.sale.quotation.form</field>
      <field name="model">sale.order</field>
      <field name="priority" eval="20"/>
      <field name="inherit_id" ref="sale.view_order_form"/>
      <field name="arch" type="xml">
        <xpath expr="//field[@name='validity_date']" position="before">
          <field name="date_order" widget="date"
            attrs="{'invisible': [('state', 'in', ['sale', 'done', 'cancel'])]}"/>
        </xpath>
        <xpath expr="//form/header" position="replace">
          <header>
            <button name="action_confirm2" id="action_confirm2"
              confirm="Click Ok button to confirm your action."
              string="Confirm Sale" class="btn-primary" type="object"
              attrs="{'invisible': [('state', 'not in', ['sent'])]}"/>
            <button name="action_confirm2"
              confirm="Click Ok button to confirm your action."
              string="Confirm Sale" type="object"
              attrs="{'invisible': [('state', 'not in', ['draft'])]}"/>
            <button name="action_cancel" states="draft,sent,sale" 
              confirm="Click Ok button to confirm your action."
              type="object" string="Cancel"/>
            <button name="action_draft" states="cancel" type="object" 
                confirm="Click Ok button to confirm your action."
                string="Set to Quotation"/>
            <button name="action_done" type="object" string="Lock" states="sale"
                confirm="Click Ok button to confirm your action."
                help="If the sale is locked, you can not modify it anymore. However, you will still be able to invoice or deliver."/>
            <button name="action_unlock" type="object" string="Unlock" 
                confirm="Click Ok button to confirm your action."
                states="done" groups="sales_team.group_sale_manager"/>
            <button name="print_saleorder_service" class="oe_highlight"
                attrs="{'invisible': [('so_type','!=','service')]}"
                string="Print Service" type="object"/>
            <button name="print_saleorder_parts" class="oe_highlight"
                attrs="{'invisible': [('so_type','!=','service')]}"
                string="Print Parts" type="object"/>
            <button name="print_so_service" class="oe_highlight"
                attrs="{'invisible': ['|',('so_type','!=','service'),('state','!=','sale')]}"
                string="Print S.O Service" type="object"/>
             <button name="print_so_parts" class="oe_highlight"
                attrs="{'invisible': [('so_type','!=','parts')]}"
                string="Print S.O Parts" type="object"/>    
             <button name="print_so_units" class="oe_highlight"
                attrs="{'invisible': [('so_type','!=','units')]}"
                string="Print S.O Units" type="object"/>             
            <field name="state" widget="statusbar" statusbar_visible="draft,sent,sale"/>
            <field name="so_type" invisible="1"/>
          </header>
        </xpath>
        <xpath expr="//form/sheet/group/group[1]" position="attributes">
          <attribute name="string">Customer Info</attribute>
        </xpath>
        
        <xpath expr="//form/sheet/group/group[2]" position="attributes">
          <attribute name="string">Order Info</attribute>
        </xpath>
        <xpath expr="//field[@name='payment_term_id']" position="after">
          <field name="job_type" attrs="{'invisible': [('so_type','!=','service')]}"/>
          <field name="fas_area_id" attrs="{'invisible': [('so_type','!=','service')]}"/>
          <field name="run_km" attrs="{'invisible': [('so_type','!=','service')]}"/>          
        </xpath>
        <xpath expr="//form/sheet/group/group[2]/field[@name='payment_term_id']" position="attributes">
          <attribute name="attrs">{'invisible': [('so_type','=','units')]}</attribute>
        </xpath>
        <xpath expr="//form/sheet/group" position="inside">
          <group string="Unit Info" attrs="{'invisible': ['|',('so_type','!=','units'),('state','in',['draft','sent'])]}">
            <field name="su_fu_id" 
              attrs="{'readonly': [('state','!=','sale')], 'required': [('so_type','=','units'),('state','=','sale')]}"
              options="{'no_create': True, 'no_quick_create': True, 'no_create_edit': True, 'no_open': True}"/>
            <field name="su_fu_local_name_id"/>
            <field name="su_fu_engine_number"/>
            <field name="su_fu_chassis_number"/>
	          <field name="su_fu_conduction_sticker"/>
            <field name="su_fu_color"/>
            <field name="su_fu_plate_number"/>
          </group>
          <group string="Payment Info" attrs="{'invisible': ['|',('so_type','!=','units'),('state','in',['draft','sent'])]}">
            <field name="fos_payment_mode_id" attrs="{'readonly': [('state','!=','sale')], 'required': [('so_type','=','units'),('state','=','sale')]}"
              options="{'no_create': True, 'no_quick_create': True, 'no_create_edit': True}" widget="many2one"/>        
            <field name="payment_mode_name" invisible="1"/>
            <field name="fos_bank_id" 
              attrs="{'readonly': [('state','!=','sale')], 'required': [('payment_mode_name','in',('Bank','bank','BANK')),('so_type','=','units')], 'invisible': [('payment_mode_name','in', (False, 'Cash','cash','CASH'))]}"
              options="{'no_create': True, 'no_quick_create': True, 'no_create_edit': True}" widget="many2one"/>                            
            <field name="unit_si_amount"/>
            <field name="unit_si_date"/>
            <field name="dp_percentage" attrs="{'readonly': [('state','!=','sale')], 'invisible': [('payment_mode_name','in', (False, 'Cash','cash','CASH'))]}"/>
            <field name="dp_amount" attrs="{'readonly': [('state','!=','sale')], 'invisible': [('payment_mode_name','in', (False, 'Cash','cash','CASH'))]}"/>
            <field name="af" attrs="{'readonly': [('state','!=','sale')], 'invisible': [('payment_mode_name','in', (False, 'Cash','cash','CASH'))]}"/>
            <field name="fos_payment_term_id" attrs="{'readonly': [('state','not in','draft')], 'invisible': [('payment_mode_name','in', (False, 'Cash','cash','CASH'))]}"/>
            <field name="insurance_company" attrs="{'readonly': [('state','!=','sale')]}"/>                            
          </group>                            
          <group string="Sales Info" attrs="{'invisible': ['|',('so_type','!=','units'),('state','in',['draft','sent'])]}">
            <field name="date_released"/>
            <field name="user_id" string="Sales Executive" attrs="{'readonly': [('state','!=','sale')]}"
              options="{'no_create': True, 'no_quick_create': True, 'no_create_edit': True}"/>
            <field name="source_of_awareness" attrs="{'readonly': [('state','!=','sale')]}"/>
            <field name="venue_of_marketing_activity" attrs="{'readonly': [('state','!=','sale')]}"/>
            <field name="source_of_sale" attrs="{'readonly': [('state','!=','sale')]}"/>
            <field name="promo" attrs="{'readonly': [('state','!=','sale')]}"/>
          </group>
        </xpath>
        <xpath expr="//field[@name='partner_shipping_id']" position="after">
          <field name="fu_id" 
            attrs="{'readonly': [('state', '!=', 'draft')], 'invisible': [('so_type','!=','service')], 'required': [('so_type','=','service')]}"
            options="{'no_create': True, 'no_quick_create': True, 'no_create_edit': True, 'no_open': True}"/>
          <field name="fu_local_name_id" options="{'no_create': True, 'no_quick_create': True, 'no_create_edit': True, 'no_open': True}"
             attrs="{'invisible': [('so_type','!=','service')]}"/>
          <field name="fu_chassis_number" attrs="{'invisible': [('so_type','!=','service')]}"/>
          <field name="fu_engine_number" attrs="{'invisible': [('so_type','!=','service')]}"/>
          <field name="fu_conduction_sticker" attrs="{'invisible': [('so_type','!=','service')]}"/>
          <field name="fu_plate_number" attrs="{'invisible': [('so_type','!=','service')]}"/>
        </xpath>
        <xpath expr="//field[@name='note']" position="after">
          <group string="Signatories" col="3">
            <group>
              <field name="prepared_by_id"/>
              <field name="prepared_by_desig"/>
            </group>
            <group>
              <field name="approved_by"/>
              <field name="approved_by_desig"/>
            </group>
            <group>
              <field name="checked_by"/>
              <field name="checked_by_desig"/>
              </group>
          </group>
        </xpath>
        <xpath expr="//group[@name='sale_pay']/field[@name='date_order']" position="replace"/>
        <xpath expr="//form/sheet/notebook/page/field[@name='order_line']" position="replace">
          <!-- Order Lines for Parts -->          
          <field name="order_line" mode="tree,kanban"
            attrs="{'readonly': [('state', 'in', ('done','cancel'))]}">            
            <tree string="Sales Order Lines" decoration-info="invoice_status=='to invoice'" editable="bottom">
              <field name="order_id" invisible="1"/>
              <field name="sequence" widget="handle"/>
              <field name="product_updatable" invisible="1"/>
              <field name="charged_to"/>
              <!-- show units column for parts sales -->
              <field name="fu_id" 
                attrs="{'column_invisible': [('parent.so_type','in',['service','units'])]}"
                options="{'no_create': True, 'no_quick_create': True, 'no_create_edit': True, 'no_open': True}"/>              
              <field name="product_id" invisible="1"
                attrs="{'readonly': [('product_updatable', '=', False)]}"
                domain="['|',('type','=','service'),('sub_type','=','parts')]" 
                force_save="1" options="{'no_create': True, 'no_quick_create': True, 'no_create_edit': True, 'no_open': True}"
                context="{'partner_id':parent.partner_id, 'quantity':product_uom_qty, 'pricelist':parent.pricelist_id, 'uom':product_uom, 'company_id': parent.company_id}"/>
              <!-- product for parts sales -->
              <field name="part_number" 
                attrs="{'column_invisible': [('parent.so_type','!=','parts')], 'required': [('parent.so_type','=','parts')]}"
                domain="[('sub_type','=','parts')]"/>
              <!-- product for servicing sales -->
              <field name="parts_and_jobs" 
                attrs="{'column_invisible': [('parent.so_type','!=','service')], 'required': [('parent.so_type','=','service')]}"
                domain="['|',('type','=','service'),('sub_type','=','parts')]"/>
              <!-- product for units sales -->              
              <field name="units_and_addons" 
                attrs="{'column_invisible': [('parent.so_type','!=','units')], 'required': [('parent.so_type','=','units')]}"
                domain="[('sub_type','=','units')]"/>

              <field name="layout_category_id" groups="sale.group_sale_layout"/>
              <field name="name"/>
              <field name="product_uom_qty" string="Ordered Qty"
                context="{'partner_id':parent.partner_id, 'quantity':product_uom_qty, 'pricelist':parent.pricelist_id, 'uom':product_uom, 'company_id': parent.company_id}"/>
              <field name="qty_delivered" attrs="{'column_invisible': [('parent.state', 'not in', ['sale', 'done'])], 'readonly': [('qty_delivered_updateable', '=', False)]}"/>
              <field name="qty_invoiced" attrs="{'column_invisible': [('parent.state', 'not in', ['sale', 'done'])]}"/>
              <field name="qty_to_invoice" invisible="1"/>
              <field name="product_uom" attrs="{'readonly': [('state', 'in', ('sale','done', 'cancel'))]}"
                context="{'company_id': parent.company_id}" groups="product.group_uom" options='{"no_open": True}'/>
              <field name="analytic_tag_ids" groups="analytic.group_analytic_accounting" widget="many2many_tags" options="{'color_field': 'color'}"/>
              <field name="price_unit" attrs="{'readonly': [('qty_invoiced', '&gt;', 0)]}"/>
              <field name="tax_id" widget="many2many_tags" options="{'no_create': True}" domain="[('type_tax_use','=','sale'),('company_id','=',parent.company_id)]"
                attrs="{'readonly': [('qty_invoiced', '&gt;', 0)]}"/>
              <field name="discount" groups="sale.group_discount_per_so_line"/>
              <field name="discount_amount" groups="sale.group_discount_per_so_line"/>
              <field name="price_subtotal" widget="monetary" groups="sale.group_show_price_subtotal"/>
              <field name="price_total" widget="monetary" groups="sale.group_show_price_total"/>
              <field name="qty_delivered_updateable" invisible="1"/>
              <field name="state" invisible="1"/>
              <field name="invoice_status" invisible="1"/>
              <field name="customer_lead" invisible="1"/>
              <field name="currency_id" invisible="1"/>
            </tree>
          </field>
        </xpath>
      </field>
    </record>

    <record model="ir.sequence" id="fos_spso_seq">
      <field name="name">Parts Sales Order</field>
      <field name="code">fos.spso.seq</field>
      <field name="prefix">PARTS-SO-%(y)s-%(month)s-</field>
      <field name="padding">6</field>
    </record>

    <record model="ir.sequence" id="fos_spsq_seq">
      <field name="name">Parts Sales Quotation</field>
      <field name="code">fos.spsq.seq</field>
      <field name="prefix">PARTS-SQ-%(y)s-%(month)s-</field>
      <field name="padding">6</field>
    </record>

    <record model="ir.sequence" id="fos_svre_seq">
      <field name="name">Repair Estimate</field>
      <field name="code">fos.svre.seq</field>
      <field name="prefix">SERVICE-RE-%(y)s-%(month)s-</field>
      <field name="padding">6</field>
    </record>

    <record model="ir.sequence" id="fos_svso_seq">
      <field name="name">Service Order</field>
      <field name="code">fos.svso.seq</field>
      <field name="prefix">SERVICE-RO-%(y)s-%(month)s-</field>
      <field name="padding">6</field>
    </record>

    <record model="ir.sequence" id="fos_susq_seq">
      <field name="name">Unit Sales Quotation</field>
      <field name="code">fos.susq.seq</field>
      <field name="prefix">UNIT-SQ-%(y)s-%(month)s-</field>
      <field name="padding">6</field>
    </record>

    <record model="ir.sequence" id="fos_suso_seq">
      <field name="name">Unit Sales Order</field>
      <field name="code">fos.suso.seq</field>
      <field name="prefix">UNIT-SO-%(y)s-%(month)s-</field>
      <field name="padding">6</field>
    </record>

    <menuitem id="sale.sale_menu_root"
      name="Sales - Parts" 
      web_icon="sale,static/description/icon.png" sequence="7"/>

    <menuitem id="sale.product_menu_catalog" name="Products &amp; Clients"
      action="product.product_template_action" 
      parent="sale.sale_menu_root" 
      sequence="4" groups="sales_team.group_sale_salesman"/>
    
    <menuitem id="sale.res_partner_menu"
      parent="sale.product_menu_catalog"
      action="base.action_partner_form"
      sequence="3" groups="sales_team.group_sale_salesman"/>
  </data>
</odoo>
